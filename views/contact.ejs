<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liên Hệ | ArvaLibrary</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-gray-50">
    <header class="bg-gray-900 text-white shadow-lg sticky top-0 z-10">
        <div class="flex items-center justify-between max-w-7xl mx-auto p-4">
            <a href="/" class="text-2xl font-bold text-yellow-400">ArvaLibrary</a>
            <div class="flex-grow max-w-md mx-4 hidden md:block">
                <form onsubmit="alert('Chức năng tìm kiếm chưa được triển khai.'); return false;" class="flex">
                    <input type="text" name="q" placeholder="Tìm kiếm..."
                        class="w-full p-2 text-sm text-gray-900 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"
                        required>
                    <button type="submit"
                        class="p-2 text-sm font-medium text-white bg-yellow-600 rounded-r-lg hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition duration-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </button>
                </form>
            </div>
            <div class="flex items-center space-x-2">
                <a href="/contact" class="hidden sm:inline-block">
                    <button
                        class="text-sm font-medium py-2 px-4 rounded-lg flex items-center transition duration-200 bg-yellow-700 hover:bg-yellow-800 whitespace-nowrap">
                        Liên hệ
                    </button>
                </a>
            </div>
        </div>
    </header>

    <main class="max-w-3xl mx-auto p-4 sm:p-6 my-12">
        <div class="bg-white shadow-2xl rounded-xl p-6 md:p-10 border border-gray-200">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-4 text-center">Liên Hệ Với ArvaLibrary</h1>
            <p class="text-center text-gray-600 mb-10">
                Hãy gửi yêu cầu đặt sách hoặc bất kỳ câu hỏi nào về dịch vụ của chúng tôi.
            </p>

            <form id="contactForm" onsubmit="submitForm(event)">
                <div class="mb-5">
                    <label for="recipient_email" class="block text-sm font-medium text-gray-500">Email Gửi Đến</label>
                    <input type="email" id="recipient_email" name="recipient_email" value="arvalibrary@gmail.com"
                        readonly
                        class="mt-1 block w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-lg shadow-sm focus:outline-none text-gray-700 cursor-not-allowed">
                </div>

                <div class="mb-5">
                    <label for="your_email" class="block text-sm font-medium text-gray-700">Email Của Bạn <span
                            class="text-red-500">*</span></label>
                    <input type="email" id="your_email" name="your_email" placeholder="" required
                        class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-yellow-500 focus:border-yellow-500 transition duration-150">
                </div>

                <div class="mb-5">
                    <label for="subject" class="block text-sm font-medium text-gray-700">Tiêu Đề Nội Dung <span
                            class="text-red-500">*</span></label>
                    <input type="text" id="subject" name="subject" placeholder="" required
                        class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-yellow-500 focus:border-yellow-500 transition duration-150">
                </div>

                <div class="mb-8">
                    <label for="message" class="block text-sm font-medium text-gray-700">Nội Dung Chi Tiết <span
                            class="text-red-500">*</span></label>
                    <textarea id="message" name="message" rows="7" required
                        placeholder="Hãy viết chi tiết yêu cầu của bạn tại đây..."
                        class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-yellow-500 focus:border-yellow-500 transition duration-150 resize-y"></textarea>
                </div>

                <div class="text-center">
                    <button type="submit"
                        class="w-full sm:w-auto py-3 px-10 text-xl font-bold text-white bg-yellow-600 rounded-lg hover:bg-yellow-700 transition duration-300 shadow-xl transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-yellow-500/50">
                        Gửi Yêu Cầu
                    </button>
                </div>
            </form>

            <div id="confirmationBox"
                class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
                <div
                    class="bg-white rounded-xl p-8 max-w-sm w-full shadow-2xl transform transition duration-300 scale-100">
                    <h3 class="text-2xl font-bold text-green-600 mb-4 text-center">Thành Công!</h3>
                    <p class="text-gray-700 mb-6 text-center">
                        Chúng tôi đã nhận được yêu cầu và sẽ phản hồi qua email của bạn trong thời gian sớm nhất. Xin
                        cảm ơn!
                    </p>
                    <button onclick="hideConfirmation()"
                        class="w-full py-2 px-4 bg-yellow-600 text-white font-medium rounded-lg hover:bg-yellow-700 transition duration-200">
                        Đóng
                    </button>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-800 text-white mt-12">
        <div class="max-w-7xl mx-auto p-6 text-center text-sm text-gray-400">
            &copy; 2025 ArvaLibrary. Mọi quyền được bảo lưu. Hotline: 0337126684
        </div>
    </footer>

    <script>
        // Hàm hiển thị hộp thông báo xác nhận (Giữ nguyên)
        function showConfirmation() {
            document.getElementById('confirmationBox').classList.remove('hidden');
        }

        // Hàm ẩn hộp thông báo xác nhận (Giữ nguyên)
        function hideConfirmation() {
            document.getElementById('confirmationBox').classList.add('hidden');
        }

        // ⭐ Xử lý việc gửi form (Gửi qua Fetch API đến Server)
        async function submitForm(event) {
            event.preventDefault();

            const form = event.target;
            const formButton = form.querySelector('button[type="submit"]');

            // Chuẩn bị dữ liệu form
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            // Cập nhật trạng thái nút
            const originalText = formButton.textContent;
            formButton.textContent = 'Đang gửi...';
            formButton.disabled = true;

            try {
                // Gửi yêu cầu POST AJAX đến route /contact trên server
                const response = await fetch('/contact', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                const result = await response.json();

                if (result.success) {
                    // Thành công: Server đã xử lý và gửi email
                    showConfirmation();
                    form.reset();
                } else {
                    // Thất bại: Lỗi từ phía server (ví dụ: không điền đủ thông tin, lỗi gửi email)
                    alert(`Lỗi: ${result.message}`);
                    console.error("Lỗi Server:", result.message);
                }
            } catch (error) {
                // Lỗi kết nối hoặc lỗi bất ngờ
                console.error('Lỗi khi gửi form:', error);
                alert('Đã xảy ra lỗi kết nối. Vui lòng thử lại.');
            } finally {
                // Đặt lại nút gửi sau khi hoàn thành (dù thành công hay thất bại)
                formButton.textContent = originalText;
                formButton.disabled = false;
            }
        }
    </script>


</body>

</html>